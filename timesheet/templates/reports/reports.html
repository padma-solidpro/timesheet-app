{% extends 'base.html' %}

{% block content %}
  <h3 class="page-header">Reports</h1>

  <!-- Filter Form -->
  <form id="filter-form" method="get" class="filter-form">
    <!-- Report Type -->
    <div class="filter-group">
      <label for="report_type">Select Report:</label>
      <select id="report_type" name="report_type" class="form-select form-select-sm" style="width: 220px;">
        {% if access_level > 2 %}
          <option value="project_cost_tracking" {% if report_type == 'project_cost_tracking' %}selected{% endif %}>Project Cost Tracking</option>
          <option value="project_task_tracking" {% if report_type == 'project_task_tracking' %}selected{% endif %}>Project Task Tracking</option>
          <option value="employee_utilization" {% if report_type == 'employee_utilization' %}selected{% endif %}>Employee Utilization</option>
        {% endif %}
        
        <option value="timesheet_log_reports" {% if report_type == 'timesheet_log_reports' %}selected{% endif %}>Timesheet Log Reports</option>
      </select>
    </div>

    <!-- Date Filters -->
    {% if report_type == 'employee_utilization' or report_type == 'timesheet_log_reports' %}
    <div class="filter-group">
      <label for="start_date">Start:</label>
      <input type="date" name="start_date" id="start_date" class="form-control form-control-sm" value="{{ request.GET.start_date|default:start_date }}">
    </div>

    <div class="filter-group">
      <label for="end_date">End:</label>
      <input type="date" name="end_date" id="end_date" class="form-control form-control-sm" value="{{ request.GET.end_date|default:end_date}}">
    </div>

    <div class="filter-group">
      <button type="submit" class="btn btn-primary btn-sm">Apply</button>
    </div>
    {% endif %}
  </form>
  <!-- Report Table -->
  <div id="report_table_container">
    {% include template_name %}
  </div>

  <script>
    $(document).ready(function () {
      // When report type is changed, reload page with selected type
      $('#report_type').on('change', function () {
        const selectedReport = $(this).val();
        const url = new URL(window.location.href);
        url.searchParams.set('report_type', selectedReport);
        // Remove any existing date filters when switching reports
        url.searchParams.delete('start_date');
        url.searchParams.delete('end_date');
        window.location.href = url.toString();
      });

    });
  </script>
{% endblock %}

